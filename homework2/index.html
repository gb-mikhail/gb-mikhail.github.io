<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="src/style.css">
    <title>Loft School sample project</title>

</head>
<body id="mainbody">
<div class="main-container">
    <div class="main-container__friend-box">
        <div class="friend-box__top-box">
            <h1 class="top-box_h1">
                Выбери друзей
            </h1>
        </div>
        <div class="friend-box__search-box">
            <input class="search-box_input" id="left-search-box_input" placeholder="Начните вводить имя друга">
            <input class="search-box_input" id="right-search-box_input" placeholder="Начните вводить имя друга">
        </div>
        <div class="friend-box__central-box">
            <div class="central-box__left-list">
                <div class="central-box__h3">
                    Ваши друзья
                </div>
                <hr>
                <div id="friends" ondragenter="return dragEnter(event)" ondrop="return dragDrop(event)"
                     ondragover="return dragOver(event)"></div>
            </div>
            <div class="central-box__right-list">
                <div class="central-box__h3">
                    Друзья в списке
                </div>
                <hr>
                <div id="friendsNewlist" ondragenter="return dragEnter(event)" ondrop="return dragDrop(event)"
                     ondragover="return dragOver(event)"></div>
            </div>
        </div>
        <div class="friend-box__bottom-box">
            <button class="friend-box__bottom-box_button-reset">
                Сбросить
            </button>
            <button class="friend-box__bottom-box_button">
                Сохранить
            </button>

        </div>
    </div>
</div>
<script src="http://vk.com/js/api/openapi.js" type="text/javascript"></script>
<script type="text/javascript">
    function dragStart(ev) {
        ev.dataTransfer.effectAllowed = 'move';
        ev.dataTransfer.setData("Text", ev.target.getAttribute('id'));
        ev.dataTransfer.setDragImage(ev.target, 100, 30);
        return true;
    }
    function dragEnter(ev) {
        ev.preventDefault();
        return true;
    }
    function dragOver(ev) {
        ev.preventDefault();
    }
    function dragDrop(ev) {
        let data = ev.dataTransfer.getData("Text");
        let children = ev.target.children;
        let children2 = ev.target.parentNode.children;
        let rightSearch = document.getElementById('right-search-box_input');
        let leftSearch = document.getElementById('left-search-box_input');

        if (ev.target.parentNode.id === 'friendsNewlist') {
            ev.target.parentNode.appendChild(document.getElementById(data));

            for (let i = 0; i < children2.length; i++) {
                document.getElementById(data).lastChild.innerHTML = '-';
                let childrenI = children2[i];

                for (let i = 0; i < myModule.friendsIdArr.length; i++) {
                    if (myModule.friendsIdArr[i].id == childrenI.id) {
                        myModule.rightFriendsArr.push(myModule.friendsIdArr[i]);
                        myModule.friendsIdArr.splice(i, 1);
                    }
                }
            }
        } // добавление друзей в любое место

        if( ev.target.parentNode.id === 'friendsNewlist') {
            ev.target.parentNode.appendChild(document.getElementById(data));
        }

        if (ev.target.id === 'friendsNewlist') {
            ev.target.appendChild(document.getElementById(data));

            for (let i = 0; i < children.length; i++) {
                children[i].lastChild.innerHTML = '-';
                let childrenI = children[i];
                console.log(childrenI.id);

                for (let i = 0; i < myModule.friendsIdArr.length; i++) {
                    if (myModule.friendsIdArr[i].id == childrenI.id) {
                        myModule.rightFriendsArr.push(myModule.friendsIdArr[i]);
                        myModule.friendsIdArr.splice(i, 1);
                    }
                }
            }
        } // добавление друзей в список

        if (ev.target.parentNode.id === 'friends') {
            ev.target.parentNode.appendChild(document.getElementById(data));

            for (let i = 0; i < children2.length; i++) {
                document.getElementById(data).lastChild.innerHTML = '+';
                let childrenI = children2[i];

                for (let i = 0; i < myModule.rightFriendsArr.length; i++) {
                    if (myModule.rightFriendsArr[i].id == childrenI.id) {
                        myModule.friendsIdArr.push(myModule.rightFriendsArr[i]);
                        myModule.rightFriendsArr.splice(i, 1);
                    }
                }
            }
        }// возврат друзей в любое место
        if (ev.target.id === 'friends') {
            ev.target.appendChild(document.getElementById(data));

            for (let i = 0; i < children.length; i++) {
                children[i].lastChild.innerHTML = '+';
                let childrenI = children[i];

                for (let i = 0; i < myModule.rightFriendsArr.length; i++) {
                    if (myModule.rightFriendsArr[i].id == childrenI.id) {
                        myModule.friendsIdArr.push(myModule.rightFriendsArr[i]);
                        myModule.rightFriendsArr.splice(i, 1);
                    }
                }
            }
        }// возврат друзей в список

        function searchSide(side) {
            let keyUp = new Event('keyup', {
                search: side.value = ''
            });
            side.dispatchEvent(keyUp);
        }

        if (ev.target.id || ev.target.parentNode.id === 'friendsNewlist') {
            searchSide(rightSearch);
        }

        if (ev.target.id || ev.target.parentNode.id === 'friends') {
            searchSide(leftSearch);
        }

        ev.stopPropagation();
        return false;
    }
</script>
<script type="text/javascript" src="cf3021f6acf6f7cc3984.js"></script></body>
</html>